!function(t){"use strict";var e=function(){var e=function(t){return document.createElementNS("http://www.w3.org/2000/svg",t)},n=function(n,a){var i=t(e("svg"));t(i).attr("width",n),t(i).attr("height",a);var r=t(e("g"));return t(i).append(r),i},a=function(e){var n=document.createElement("div");t(n).attr("class",e);var a=document.createElement("div");return t(n).append(a),n},i=function(n){var a=t(e("path")),i={fill:"none",stroke:n.dail_stroke_color,"stroke-width":n.dail_stroke_width+"px","stroke-linecap":"butt","stroke-linejoin":"miter","stroke-opacity":"1"};for(var r in i)t(a).attr(r,i[r]);return a};return{up:function(e){var r=e.dail_w,d=e.dail_h,o=n(r,d),s=i(e);t(s).attr("d","m0,"+(d+e.dail_stroke_width)+"l"+r/2+",-"+d+"l"+r/2+","+d),t(o).find("g").append(s);var u=a("dial up");return t(u).find("div").append(o),u},down:function(e){var r=e.dail_w,d=e.dail_h,o=n(r,d),s=i(e);t(s).attr("d","m0,-"+e.dail_stroke_width+"l"+r/2+","+d+"l"+r/2+",-"+d),t(o).find("g").append(s);var u=a("dial down");return t(u).find("div").append(o),u}}}(),n=function(e,n,a){this.index=e,this.dataModel=new function(t,e){this.data=t,this.index=e,this.getText=function(){return this.data[this.index]}}(a.data,n),this.init=function(){this.angle=a.theta*e,this.elem=document.createElement("figure"),t(this.elem).addClass("a"+100*this.angle),t(this.elem).css("opacity","0.5"),t(this.elem).css(a.transformProp,a.rotateFn+"("+-this.angle+"deg) translateZ("+a.radius+"px)"),this.setText()},this.setText=function(){t(this.elem).text(this.dataModel.getText())},this.update=function(t){this.dataModel.index!=t&&(this.dataModel.index=t,this.setText())}},a=function(a,i,r){function d(){var t=window.navigator.userAgent,e=t.indexOf("MSIE ");return e>0||!!navigator.userAgent.match(/Trident.*rv\:11\./)}var o=t(a)[0],s=t.extend({panelCount:16,rotateFn:"rotateX",interactive:!0,dail_w:20,dail_h:5,dail_stroke_color:"#999999",dail_stroke_width:1},i||{});s.transformProp=r,s.rotation=0,s.distance=0,s.last_angle=0,s.theta=360/s.panelCount,s.initselect=o.selectedIndex,s.data=[];for(var u=0;u<o.children.length;u++)s.data.push(t(o.children[u]).text());t(a).hide();var l=document.createElement("div");t(l).addClass("drum-wrapper"),s.id?t(l).attr("id",s.id):o.id?t(l).attr("id","drum_"+o.id):t(o).attr("name")&&t(l).attr("id","drum_"+t(o).attr("name")),t(o).after(l);var c=document.createElement("div");t(c).addClass("inner"),t(c).appendTo(l);var h=document.createElement("div");t(h).addClass("container"),t(h).appendTo(c);var p=document.createElement("div");if(t(p).addClass("drum"),t(p).appendTo(h),s.interactive===!0){var f=e.up(s);t(l).append(f);var m=e.down(s);t(l).append(m),t(l).hover(function(){t(this).find(".up").show(),t(this).find(".down").show()},function(){t(this).find(".up").hide(),t(this).find(".down").hide()})}s.radius=Math.round(t(p).height()/2/Math.tan(Math.PI/s.panelCount)),s.mapping=[];for(var v=0,u=0;u<s.panelCount&&s.data.length!=u;u++){var g=v;v>=s.panelCount/2&&(g=s.data.length-(s.panelCount-v)),v++;var x=new n(u,g,s);x.init(),s.mapping.push(x),t(p).append(x.elem)}var w=function(t){t=t||s.rotation;var e=s.theta/2,n=360,a=((t+e)%n+n)%n;a-=a%s.theta;var i=(s.data.length-1)*s.theta;return a>i?t>0?i:0:a},_=function(){var t=w();for(var e in s.mapping)if(s.mapping[e].angle==t)return s.mapping[e]},C=function(t){for(var e,n=[],a=s.panelCount,i=s.panelCount/2,r=s.data.length,d=t.index,o=t.dataModel.index,u=o-i;o+i-1>=u;u++)e=u,0>u&&(e=r+u),u>r-1&&(e=u-r),n.push(e);var l=n.slice(i-d);n=l.concat(n.slice(0,a-l.length));for(var d=0;d<s.mapping.length;d++)s.mapping[d].update(n[d])},M=function(){t(p).css(s.transformProp,"translateZ(-"+s.radius+"px) "+s.rotateFn+"("+s.rotation+"deg)"),t(p).css("-ms-transform","none");var e=_();if(e){var n=e.dataModel,a=o.selectedIndex;if(o.selectedIndex=n.index,a!=n.index&&s.onChange&&s.onChange(o),t(e.elem).css("opacity",1),t("figure:not(.a"+100*e.angle+", .hidden)",p).css("opacity","0.5"),d())for(var i in s.mapping){var r=-s.mapping[i].angle+s.rotation;t(s.mapping[i].elem).css(s.transformProp,s.rotateFn+"("+r+"deg) translateZ("+s.radius+"px)")}e.angle!=s.last_angle&&[0,90,180,270].indexOf(e.angle)>=0&&(s.last_angle=e.angle,C(e))}};this.setIndex=function(t){var e=Math.floor(t/s.panelCount),a=t-e*s.panelCount,i=new n(a,t,s);C(i),s.rotation=a*s.theta,M()},this.setIndex(s.initselect),this.getIndex=function(){return _().dataModel.index},"undefined"!=typeof Hammer&&(s.touch=new Hammer(l,{prevent_default:!0,no_mouseevents:!0}),s.touch.on("dragstart",function(){s.distance=0}),s.touch.on("drag",function(t){var e=["up","down"];e.indexOf(t.gesture.direction)>=0&&(s.rotation+=-1*Math.round(t.gesture.deltaY-s.distance),M(),s.distance=t.gesture.deltaY)}),s.touch.on("dragend",function(){s.rotation=w(),M()})),s.interactive&&(t(f).click(function(){var t=s.rotation+s.theta+1;s.rotation=w(t),M()}),t(m).click(function(){var t=s.rotation-s.theta-1;s.rotation=w(t),M()}))},i={getIndex:function(){return t(this).data("drum")?t(this).data("drum").getIndex():!1},setIndex:function(e){t(this).data("drum")&&t(this).data("drum").setIndex(e)},init:function(e){for(var n=!1,i="transform WebkitTransform MozTransform OTransform msTransform".split(" "),r=0;r<i.length;r++)void 0!==document.createElement("div").style[i[r]]&&(n=i[r]);if(n){var d=t(this);if(!d.data("drum")){var o=new a(d,e,n);d.data("drum",o)}}}};t.fn.drum=function(e){var n=arguments;return this.each(function(){return i[e]?i[e].apply(this,Array.prototype.slice.call(n,1)):"object"!=typeof e&&e?void t.error("Method "+e+" does not exist on jQuery.drum"):i.init.apply(this,n)})}}(jQuery);
